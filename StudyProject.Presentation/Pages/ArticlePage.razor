@page "/article/{Id}"
@using MathJaxBlazor
@using StudyProject.Application.Articles.Commands
@using StudyProject.Application.Articles.Commands.Get
@using StudyProject.Core.ArticleAggregate
@using StudyProject.Infrastructure
@using System.Text.RegularExpressions
@using StudyProject.Infrastructure.DTOs
@inject FirebaseContext Context
@inject HttpClient Http

@if (article == null)
{
    <p><em>Loading...</em></p>
}
else
{
	<h1>@article.Title</h1>
	@foreach (Match match in Regex.Matches(article.Content, @"(\$\$.*?\$\$|\$[^$]*\$)|([^$]+)"))
	{
		string text = match.Value;
		if (text.Contains("$$"))
		{
			<Equation Value="@text.Replace("$$", "")" />

		}
		else if (text.Contains('$'))
		{
			<Equation Value="@text.Replace('$', ' ')" TeXDisplay=false />
		}
		else
		{
			@((MarkupString)text)
		}
	}

}


@code {
	[Parameter] public string Id { get; set; }

	Article? article;

	protected override async Task OnInitializedAsync()
	{
		article = await Context.GetArticleAsync(Id);
	}

}